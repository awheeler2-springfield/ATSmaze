<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ATS Resume Maze — Conceptual Model</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  display: flex;
  height: 100vh;
}

#rail {
  width: 300px;
  background: #1D3461;
  color: white;
  padding: 20px;
  box-sizing: border-box;
}

#rail h2 {
  margin-top: 0;
}

#maze {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(4, 180px);
  grid-template-rows: repeat(3, 130px);
  gap: 20px;
  justify-content: center;
  align-content: center;
  background: #f5f5f5;
}

.node {
  background: white;
  border: 2px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  text-align: center;
  padding: 10px;
  font-weight: bold;
  transition: 0.2s ease;
}

.visited {
  background: #FFFBF0;
  border-color: #C96A00;
}

.current {
  background: #F0FAFB;
  border-color: #0A6E6E;
}

.available {
  border-color: #0A6E6E;
}

.disabled {
  pointer-events: none;
  opacity: 0.5;
}

#diagnostic {
  margin-top: 20px;
  font-size: 0.9rem;
  line-height: 1.4;
}
</style>
</head>
<body>

<div id="rail">
  <h2>ATS Resume Maze</h2>
  <p><strong>Moves:</strong> <span id="moveCount">0</span></p>
  <p><strong>Score:</strong> <span id="score">100</span></p>
  <div id="diagnostic"></div>
</div>

<div id="maze">
  <div class="node" id="header">Header</div>
  <div class="node" id="summary">Summary</div>
  <div class="node" id="skills">Skills</div>
  <div class="node" id="graphics_resume">Graphic Design Resume</div>
  <div class="node" id="experience">Experience</div>
  <div class="node" id="keyword_stuffing">Keyword Stuffing</div>
  <div class="node" id="projects">Projects</div>
  <div class="node" id="certifications">Certifications</div>
  <div class="node" id="education">Education</div>
</div>

<script type="module">

/* =========================
   GRAPH — Conceptual Flow
========================= */

const graph = {
  header: ["summary"],
  summary: ["skills", "graphics_resume"],
  skills: ["experience", "keyword_stuffing"],
  graphics_resume: ["skills"],
  keyword_stuffing: ["experience"],
  experience: ["projects"],
  projects: ["certifications"],
  certifications: ["education"],
  education: []
};

const trapExplanations = {
  graphics_resume: "Graphic-heavy resumes often fail ATS parsing because text is embedded in images.",
  keyword_stuffing: "Keyword stuffing can trigger ATS filters or lower semantic match quality."
};

function validateGraph(graph) {
  for (const node in graph) {
    graph[node].forEach(neighbor => {
      if (!graph[neighbor]) {
        throw new Error(`Invalid edge: ${node} → ${neighbor}`);
      }
    });
  }
}

validateGraph(graph);

/* =========================
   STATE
========================= */

function createInitialState() {
  return {
    currentNode: "header",
    visited: new Set(["header"]),
    moves: 0,
    trapsHit: new Set(),
    complete: false
  };
}

const state = createInitialState();

/* =========================
   ENGINE
========================= */

function attemptMove(state, targetNode) {
  if (state.complete) return { success: false };

  if (!graph[state.currentNode].includes(targetNode)) {
    return { success: false };
  }

  state.moves++;
  state.currentNode = targetNode;
  state.visited.add(targetNode);

  if (trapExplanations[targetNode]) {
    state.trapsHit.add(targetNode);
  }

  if (targetNode === "education") {
    state.complete = true;
  }

  return { success: true };
}

function calculateScore(state) {
  return Math.max(
    0,
    100 - state.moves - (state.trapsHit.size * 10)
  );
}

/* =========================
   RENDER
========================= */

function render(state) {
  document.querySelectorAll(".node").forEach(el => {
    el.classList.remove("visited", "current", "available", "disabled");
    el.classList.add("disabled");
  });

  state.visited.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.add("visited");
  });

  const currentEl = document.getElementById(state.currentNode);
  currentEl.classList.add("current");

  graph[state.currentNode].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.classList.remove("disabled");
      el.classList.add("available");
    }
  });
}

/* =========================
   RAIL + END DIAGNOSTIC
========================= */

function updateRail(state) {
  document.getElementById("moveCount").textContent = state.moves;
  document.getElementById("score").textContent = calculateScore(state);

  if (state.complete) {
    showDiagnostic(state);
  }
}

function showDiagnostic(state) {
  let message = "<h3>ATS Diagnostic Report</h3>";

  if (state.trapsHit.size === 0) {
    message += "<p>You avoided major ATS pitfalls. Strong structural sequencing.</p>";
  } else {
    state.trapsHit.forEach(trap => {
      message += `<p><strong>${trap.replace("_"," ")}</strong>: ${trapExplanations[trap]}</p>`;
    });
  }

  document.getElementById("diagnostic").innerHTML = message;
}

/* =========================
   MAIN
========================= */

render(state);
updateRail(state);

document.querySelectorAll(".node").forEach(node => {
  node.addEventListener("click", () => {
    const result = attemptMove(state, node.id);
    if (result.success) {
      render(state);
      updateRail(state);
    }
  });
});

</script>
</body>
</html>
