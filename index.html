<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ATS Resume Maze — Resume Layout (Hybrid C)</title>

<style>
:root{
  --bg:#f3f3f3;
  --paper:#fff;
  --ink:#111;
  --ui:#ddd;
  --nav:#1D3461;

  --yellow:#ffe86a;
  --tealbg:#F0FAFB;
  --teal:#0A6E6E;
  --red:#ff8a8a;

  --muted:#6b6b6b;
}

body{
  margin:0;
  background:var(--bg);
  font-family: Georgia, "Times New Roman", serif;
  color:var(--ink);
}

/* Left rail */
.rail{
  position:fixed;
  left:0; top:0;
  width:340px;
  height:100vh;
  background:var(--nav);
  color:#fff;
  padding:16px;
  box-sizing:border-box;
  overflow:auto;
}
.rail h2{ margin:0 0 10px; font-size:18px; font-family: Arial, sans-serif; }
.rail .stat{ margin:8px 0; font-family: Arial, sans-serif; }
.rail button{
  cursor:pointer;
  border:none;
  padding:10px 12px;
  font-weight:bold;
  border-radius:6px;
  background:#FFFBF0;
  color:var(--nav);
  margin-top:10px;
}
.rail button:hover{ filter:brightness(0.95); }

#hint{
  margin-top:10px;
  font-family: Arial, sans-serif;
  font-size:0.86rem;
  line-height:1.25;
  opacity:0.95;
  padding:10px;
  border-radius:8px;
  background:rgba(255,255,255,0.10);
}

#pathBox{ margin-top:12px; font-family: Arial, sans-serif; font-size:0.86rem; }
#pathBox code{
  display:block;
  background:rgba(255,255,255,0.12);
  padding:8px;
  border-radius:6px;
  margin-top:6px;
  word-break:break-word;
}

#report{ margin-top:16px; font-family: Arial, sans-serif; font-size:0.92rem; line-height:1.35; }

/* Resume page */
.page{
  margin-left:340px;
  padding:30px 20px;
}
.resume{
  max-width:980px;
  margin:0 auto;
  background:var(--paper);
  padding:46px 64px;
  box-shadow:0 2px 14px rgba(0,0,0,.08);
}

.section{ margin-top:22px; }
.section-title{
  font-weight:bold;
  border-bottom:1px solid #000;
  padding-bottom:4px;
  margin-bottom:10px;
  letter-spacing:0.4px;
}

/* Clickable nodes (resume-integrated) */
.node{
  display:inline-block;
  padding:2px 4px;
  border-radius:3px;
  cursor:pointer;
}
.node.disabled{ pointer-events:none; opacity:0.45; }
.node.available{ outline:2px solid rgba(10,110,110,0.35); outline-offset:2px; }
.node.visited{ background:var(--yellow); opacity:.92; }
.node.current{ background:var(--tealbg); outline:2px solid var(--teal); outline-offset:2px; }
.node.bad{ background:var(--red); }

/* Make detours look like “drafting experiments” */
.detour{
  font-family: Arial, sans-serif;
  font-size: 0.85rem;
  background:#f2f2f2;
  border:1px solid #e3e3e3;
  padding:6px 8px;
  border-radius:999px;
  margin-right:8px;
  margin-bottom:6px;
}

/* Experience zone styling */
.exp-grid{
  margin-top:10px;
  padding:12px;
  border:1px solid var(--ui);
  border-radius:8px;
  background:#fafafa;
}
.exp-grid h4{
  margin:0 0 8px;
  font-family: Arial, sans-serif;
  font-size:0.92rem;
  color:#333;
}
.exp-grid .row{ margin:6px 0; }
.smallnote{
  margin-top:8px;
  font-family: Arial, sans-serif;
  font-size:0.82rem;
  color:var(--muted);
}

/* Bullets */
ul{ margin:0 0 0 22px; }
li{ margin:6px 0; }
</style>
</head>

<body>

<div class="rail">
  <h2>ATS Resume Maze</h2>

  <div class="stat"><strong>Moves:</strong> <span id="moveCount">0</span></div>
  <div class="stat"><strong>Score:</strong> <span id="score">100</span></div>
  <div class="stat"><strong>Best (this device):</strong> <span id="bestScore">—</span></div>

  <button id="resetBtn" type="button">Reset Run</button>

  <div id="hint" style="display:none;"></div>

  <div id="pathBox">
    <strong>Path (this run):</strong>
    <code id="pathText">header</code>
  </div>

  <div id="report"></div>
</div>

<div class="page">
  <div class="resume">

    <div class="section">
      <div class="section-title">HEADER</div>
      <p id="headerLine"></p>
    </div>

    <div class="section">
      <div class="section-title">SUMMARY</div>
      <p id="summaryLine"></p>
    </div>

    <div class="section">
      <div class="section-title">SKILLS</div>
      <p id="skillsLine"></p>
    </div>

    <div class="section">
      <div class="section-title">PROFESSIONAL EXPERIENCE</div>

      <ul id="expBackbone"></ul>

      <div class="exp-grid">
        <h4>Experience Drafting Detours (changes every run)</h4>
        <div id="expDetours"></div>
        <div class="smallnote">
          Detours add moves and may trigger ATS flags that appear only at the end.
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">PROJECTS</div>
      <p id="projectsLine"></p>
    </div>

    <div class="section">
      <div class="section-title">CERTIFICATIONS</div>
      <p id="certsLine"></p>
    </div>

    <div class="section">
      <div class="section-title">EDUCATION</div>
      <p id="educationLine"></p>
    </div>

  </div>
</div>

<script type="module">
/* ---------- Persistence ---------- */
const BEST_KEY = "atsMazeBestScore";
function getBestScore() {
  const raw = localStorage.getItem(BEST_KEY);
  if (!raw) return null;
  const n = Number(raw);
  return Number.isFinite(n) ? n : null;
}
function setBestScoreIfHigher(score) {
  const best = getBestScore();
  if (best === null || score > best) localStorage.setItem(BEST_KEY, String(score));
}
function updateBestScoreUI() {
  const best = getBestScore();
  document.getElementById("bestScore").textContent = best === null ? "—" : String(best);
}

/* ---------- Traps (end-only explanation, mid-run flash only) ---------- */
const trapExplanations = {
  weak_verbs: "Weak or passive verbs reduce ATS keyword strength and clarity.",
  no_metrics: "No quantified impact reduces ranking and credibility signals.",
  generic_alignment: "Generic experience (not tailored) lowers match relevance.",
  tables_layout: "Tables/columns can scramble parsing and break field extraction.",
  graphics_icons: "Icons/graphics can hide text from ATS or introduce noise.",
  keyword_dump: "Keyword dumping can look spammy and reduce semantic match quality."
};
const trapLabels = {
  weak_verbs: "Weak verbs",
  no_metrics: "No metrics",
  generic_alignment: "Generic alignment",
  tables_layout: "Tables/columns",
  graphics_icons: "Icons/graphics",
  keyword_dump: "Keyword dumping"
};

/* ---------- Graph + Nodes ---------- */
let nodes = {};      // id -> { id, label, tag, el }
let graph = {};      // id -> [neighbors]
let experienceSideIds = []; // exp_s*

function addNode(id, label, tag="") {
  nodes[id] = { id, label, tag, el: null };
  if (!graph[id]) graph[id] = [];
}
function connect(a,b) {
  if (!graph[a]) graph[a]=[];
  if (!graph[b]) graph[b]=[];
  if (!graph[a].includes(b)) graph[a].push(b);
  if (!graph[b].includes(a)) graph[b].push(a);
}
function validateGraph(g) {
  for (const node in g) {
    g[node].forEach(neighbor => {
      if (!g[neighbor] || !g[neighbor].includes(node)) {
        throw new Error(`Asymmetric edge: ${node} ↔ ${neighbor}`);
      }
    });
  }
}

/* ---------- Hybrid Experience generator ---------- */
function randInt(min, maxInclusive) {
  return Math.floor(Math.random() * (maxInclusive - min + 1)) + min;
}
function pick(arr) {
  return arr[randInt(0, arr.length - 1)];
}

function buildHybridGraph() {
  nodes = {};
  graph = {};
  experienceSideIds = [];

  // Coarse section nodes
  addNode("header", "Header", "section");
  addNode("summary", "Summary", "section");
  addNode("skills", "Skills", "section");
  addNode("projects", "Projects", "section");
  addNode("certifications", "Certifications", "section");
  addNode("education", "Education", "section");

  connect("header","summary");
  connect("summary","skills");

  // Experience entry/exit
  addNode("exp_entry", "Experience Entry", "experience");
  addNode("exp_exit", "Experience Exit", "experience");
  connect("skills","exp_entry");
  connect("exp_exit","projects");

  // Fixed backbone
  const backbone = [
    { id:"exp_b1", label:"Role + Company context", tag:"backbone" },
    { id:"exp_b2", label:"Strong action verbs", tag:"backbone" },
    { id:"exp_b3", label:"Quantified impact", tag:"backbone" },
    { id:"exp_b4", label:"Tailored keywords to target role", tag:"backbone" },
    { id:"exp_b5", label:"Clean, ATS-friendly formatting", tag:"backbone" }
  ];
  backbone.forEach(n => addNode(n.id, n.label, n.tag));

  connect("exp_entry","exp_b1");
  connect("exp_b1","exp_b2");
  connect("exp_b2","exp_b3");
  connect("exp_b3","exp_b4");
  connect("exp_b4","exp_b5");
  connect("exp_b5","exp_exit");

  // Random detours (recoverable)
  const sideTypes = [
    { type:"weak_verbs", label:"Weak verbs (vague duties)" },
    { type:"no_metrics", label:"No metrics (no outcomes)" },
    { type:"generic_alignment", label:"Generic alignment (not tailored)" },
    { type:"tables_layout", label:"Tables/columns formatting" },
    { type:"graphics_icons", label:"Icons/graphics for bullets" },
    { type:"keyword_dump", label:"Keyword dumping" }
  ];

  const attachPoints = ["exp_b1","exp_b2","exp_b3","exp_b4"];
  const recoverMap = { exp_b1:"exp_b2", exp_b2:"exp_b3", exp_b3:"exp_b4", exp_b4:"exp_b5" };

  let sideCounter = 0;

  for (const anchor of attachPoints) {
    const branchCount = randInt(0, 2);

    for (let i=0; i<branchCount; i++) {
      sideCounter++;
      const t = pick(sideTypes);
      const sid = `exp_s${sideCounter}`;
      addNode(sid, t.label, `trap:${t.type}`);
      experienceSideIds.push(sid);

      connect(anchor, sid);

      // 45% chance of 2-step branch that returns forward (recovery)
      if (Math.random() < 0.45) {
        sideCounter++;
        const t2 = pick(sideTypes);
        const sid2 = `exp_s${sideCounter}`;
        addNode(sid2, t2.label, `trap:${t2.type}`);
        experienceSideIds.push(sid2);

        connect(sid, sid2);
        connect(sid2, recoverMap[anchor]);
      } else {
        // single-step detour loops back
        connect(sid, anchor);
      }
    }
  }

  // Continue spine
  connect("projects","certifications");
  connect("certifications","education");

  validateGraph(graph);
}

/* ---------- State ---------- */
function createInitialState() {
  return {
    currentNode: "header",
    visited: new Set(["header"]),
    moves: 0,
    trapsHit: new Map(), // type -> count
    complete: false,
    path: ["header"]
  };
}
let state = createInitialState();

/* ---------- Trap flash (B) ---------- */
function flashTrap(nodeId) {
  const el = nodes[nodeId]?.el;
  if (!el) return;

  // briefly show red, then revert to normal (visited/current handled by render)
  el.classList.add("bad");
  window.setTimeout(() => {
    el.classList.remove("bad");
    // Re-apply render so classes match state after flash
    render(state);
  }, 350);
}

/* ---------- Engine ---------- */
function recordTrapHit(s, nodeId) {
  const tag = nodes[nodeId]?.tag ?? "";
  if (!tag.startsWith("trap:")) return;

  const type = tag.split(":")[1];
  s.trapsHit.set(type, (s.trapsHit.get(type) ?? 0) + 1);

  // Visual feedback: flash red only (no narrative)
  flashTrap(nodeId);
}

function attemptMove(s, targetNode) {
  if (s.complete) return { success:false };
  if (!graph[s.currentNode]?.includes(targetNode)) return { success:false };

  s.moves++;
  s.currentNode = targetNode;
  s.visited.add(targetNode);
  s.path.push(targetNode);

  recordTrapHit(s, targetNode);

  if (targetNode === "education") s.complete = true;
  return { success:true };
}

function calculateScore(s) {
  const trapTotal = [...s.trapsHit.values()].reduce((a,b)=>a+b,0);
  return Math.max(0, 100 - s.moves - (trapTotal * 8));
}

/* ---------- DOM helpers ---------- */
function makeNodeSpan(id, textOverride=null, extraClass="") {
  const sp = document.createElement("span");
  sp.className = "node";
  if (extraClass) sp.classList.add(extraClass);
  sp.textContent = (textOverride ?? nodes[id].label);
  sp.dataset.nodeId = id;

  sp.addEventListener("click", () => {
    const result = attemptMove(state, id);
    if (result.success) {
      render(state);
      updateRail(state);
    }
  });

  nodes[id].el = sp;
  return sp;
}

function clearResumeAreas() {
  document.getElementById("headerLine").innerHTML = "";
  document.getElementById("summaryLine").innerHTML = "";
  document.getElementById("skillsLine").innerHTML = "";
  document.getElementById("projectsLine").innerHTML = "";
  document.getElementById("certsLine").innerHTML = "";
  document.getElementById("educationLine").innerHTML = "";
  document.getElementById("expBackbone").innerHTML = "";
  document.getElementById("expDetours").innerHTML = "";
}

/* ---------- Build Resume DOM (skin) ---------- */
function buildResumeDOM() {
  clearResumeAreas();

  const headerLine = document.getElementById("headerLine");
  headerLine.appendChild(makeNodeSpan("header", "FIRST LAST"));
  headerLine.appendChild(document.createTextNode(" • Springfield, MA • email@example.com • (555) 555-5555"));

  const summaryLine = document.getElementById("summaryLine");
  summaryLine.appendChild(makeNodeSpan("summary", "Data-driven analytics professional"));
  summaryLine.appendChild(document.createTextNode(" with experience translating stakeholder needs into measurable outcomes and ATS-friendly content structure."));

  const skillsLine = document.getElementById("skillsLine");
  skillsLine.appendChild(makeNodeSpan("skills", "GA4 • SEO • Content Strategy • Reporting"));
  skillsLine.appendChild(document.createTextNode(" (Skills are read by ATS best when presented as plain text, not graphics.)"));

  const expList = document.getElementById("expBackbone");

  const entryLi = document.createElement("li");
  entryLi.appendChild(makeNodeSpan("exp_entry", "Enter Experience section"));
  expList.appendChild(entryLi);

  const backboneIds = ["exp_b1","exp_b2","exp_b3","exp_b4","exp_b5"];
  for (const id of backboneIds) {
    const li = document.createElement("li");
    li.appendChild(makeNodeSpan(id));
    expList.appendChild(li);
  }

  const exitLi = document.createElement("li");
  exitLi.appendChild(makeNodeSpan("exp_exit", "Exit Experience section"));
  expList.appendChild(exitLi);

  const detours = document.getElementById("expDetours");
  if (experienceSideIds.length === 0) {
    detours.textContent = "No detours generated this run. Reset to get a different Experience landscape.";
  } else {
    let row = document.createElement("div");
    row.className = "row";
    let countInRow = 0;

    for (const sid of experienceSideIds) {
      const chip = makeNodeSpan(sid, null, "detour");
      row.appendChild(chip);
      countInRow++;
      if (countInRow >= 2) {
        detours.appendChild(row);
        row = document.createElement("div");
        row.className = "row";
        countInRow = 0;
      }
    }
    if (row.childNodes.length) detours.appendChild(row);
  }

  const projectsLine = document.getElementById("projectsLine");
  projectsLine.appendChild(makeNodeSpan("projects", "ATS Resume Maze (interactive prototype)"));
  projectsLine.appendChild(document.createTextNode(" — clickthrough adjacency game teaching ATS optimization."));

  const certsLine = document.getElementById("certsLine");
  certsLine.appendChild(makeNodeSpan("certifications", "Google Analytics Certification"));
  certsLine.appendChild(document.createTextNode(" • SEO Foundations"));

  const eduLine = document.getElementById("educationLine");
  eduLine.appendChild(makeNodeSpan("education", "B.A., Communication"));
  eduLine.appendChild(document.createTextNode(" — Institution Name"));
}

/* ---------- Rendering (enable neighbors only) ---------- */
function applyNodeClasses(el, {visited=false, current=false, available=false, disabled=false}) {
  el.classList.remove("visited","current","available","disabled");
  if (visited) el.classList.add("visited");
  if (current) el.classList.add("current");
  if (available) el.classList.add("available");
  if (disabled) el.classList.add("disabled");
}

function render(s) {
  // Disable everything by default
  for (const id in nodes) {
    const el = nodes[id].el;
    if (!el) continue;
    applyNodeClasses(el, { disabled:true });
  }

  // Mark visited
  s.visited.forEach(id => {
    const el = nodes[id]?.el;
    if (el) applyNodeClasses(el, { visited:true, disabled:true });
  });

  // Mark current
  const currentEl = nodes[s.currentNode]?.el;
  if (currentEl) applyNodeClasses(currentEl, { current:true, visited:true, disabled:true });

  // Enable neighbors
  (graph[s.currentNode] ?? []).forEach(id => {
    const el = nodes[id]?.el;
    if (el) applyNodeClasses(el, { available:true });
  });

  // Hint if on a detour node
  const hintEl = document.getElementById("hint");
  const curTag = nodes[s.currentNode]?.tag ?? "";
  if (curTag.startsWith("trap:")) {
    hintEl.style.display = "block";
    hintEl.innerHTML = `Detour selected. To continue, click a highlighted backbone item to re-enter the main path.`;
  } else {
    hintEl.style.display = "none";
    hintEl.innerHTML = "";
  }

  // Path display
  document.getElementById("pathText").textContent = s.path.join(" → ");
}

/* ---------- Rail + end-only report ---------- */
function updateRail(s) {
  const score = calculateScore(s);
  document.getElementById("moveCount").textContent = String(s.moves);
  document.getElementById("score").textContent = String(score);

  if (s.complete) {
    setBestScoreIfHigher(score);
    updateBestScoreUI();
    showEndReport(s, score);
  }
}

function showEndReport(s, score) {
  let html = `<h3>Run Summary</h3>
    <p><strong>Final score:</strong> ${score}<br/>
       <strong>Moves:</strong> ${s.moves}</p>`;

  const trapTypes = [...s.trapsHit.keys()];
  if (trapTypes.length === 0) {
    html += `<p><strong>ATS flags:</strong> none</p>
             <p>Backbone stayed strong: verbs + metrics + tailoring + clean formatting.</p>`;
  } else {
    html += `<p><strong>ATS flags triggered:</strong> ${trapTypes.length}</p>`;
    trapTypes.forEach(type => {
      const count = s.trapsHit.get(type);
      html += `<p><strong>${trapLabels[type] ?? type} (x${count}):</strong> ${trapExplanations[type] ?? "—"}</p>`;
    });
    html += `<p style="opacity:0.95; margin-top:10px;">Replay goal: fewer moves and fewer flags.</p>`;
  }

  document.getElementById("report").innerHTML = html;
}

/* ---------- Reset ---------- */
function resetRun() {
  buildHybridGraph();
  buildResumeDOM();

  state = createInitialState();
  document.getElementById("report").innerHTML = "";

  render(state);
  updateRail(state);
}

/* ---------- Init ---------- */
updateBestScoreUI();
resetRun();
document.getElementById("resetBtn").addEventListener("click", resetRun);

</script>
</body>
</html>
