<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ATS Resume Maze — Modular Prototype</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    display: flex;
    height: 100vh;
  }

  /* Left Instruction Rail */
  #rail {
    width: 260px;
    background: #1D3461;
    color: white;
    padding: 20px;
    box-sizing: border-box;
  }

  #rail h2 {
    margin-top: 0;
  }

  #rail p {
    margin: 8px 0;
  }

  /* Maze Area */
  #maze {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(4, 150px);
    grid-template-rows: repeat(3, 120px);
    gap: 20px;
    justify-content: center;
    align-content: center;
    background: #f5f5f5;
  }

  .node {
    background: white;
    border: 2px solid #ccc;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    text-align: center;
    padding: 10px;
    font-weight: bold;
    transition: 0.2s ease;
  }

  .node:hover {
    border-color: #1D3461;
  }

  .visited {
    background: #FFFBF0;
    border-color: #C96A00;
  }

  .current {
    background: #F0FAFB;
    border-color: #0A6E6E;
  }
</style>
</head>

<body>

<!-- Instruction Rail -->
<div id="rail">
  <h2>ATS Resume Maze</h2>
  <p><strong>Moves:</strong> <span id="moveCount">0</span></p>
  <p><strong>Trap Hits:</strong> <span id="trapCount">0</span></p>
  <p><strong>Score:</strong> <span id="score">100</span></p>
  <hr />
  <p id="completionMessage"></p>
</div>

<!-- Maze Grid -->
<div id="maze">
  <div class="node" id="header">Header</div>
  <div class="node" id="summary">Summary</div>
  <div class="node" id="skills">Skills</div>
  <div class="node" id="experience_1">Experience 1</div>
  <div class="node" id="experience_2">Experience 2</div>
  <div class="node" id="projects">Projects</div>
  <div class="node" id="certifications">Certifications</div>
  <div class="node" id="education">Education</div>
</div>

<script type="module">

/* =========================
   GRAPH MODULE
========================= */

const graph = {
  header: ["summary"],
  summary: ["header", "skills"],
  skills: ["summary", "experience_1"],
  experience_1: ["skills", "experience_2"],
  experience_2: ["experience_1", "projects"],
  projects: ["experience_2", "certifications"],
  certifications: ["projects", "education"],
  education: ["certifications"]
};

const traps = new Set([
  "experience_2" // Example ATS trap
]);

function validateGraph(graph) {
  for (const node in graph) {
    graph[node].forEach(neighbor => {
      if (!graph[neighbor] || !graph[neighbor].includes(node)) {
        throw new Error(`Asymmetric edge: ${node} ↔ ${neighbor}`);
      }
    });
  }
}

validateGraph(graph);


/* =========================
   STATE MODULE
========================= */

function createInitialState() {
  return {
    currentNode: "header",
    visited: new Set(["header"]),
    moves: 0,
    trapsHit: 0,
    complete: false
  };
}

const state = createInitialState();


/* =========================
   ENGINE MODULE
========================= */

function attemptMove(state, targetNode) {
  if (state.complete) return { success: false };

  const neighbors = graph[state.currentNode];

  if (!neighbors.includes(targetNode)) {
    return { success: false };
  }

  state.moves++;

  if (traps.has(targetNode)) {
    state.trapsHit++;
  }

  state.currentNode = targetNode;
  state.visited.add(targetNode);

  if (targetNode === "education") {
    state.complete = true;
  }

  return { success: true };
}

function calculateScore(state) {
  return Math.max(
    0,
    100 - state.moves - (state.trapsHit * 10)
  );
}


/* =========================
   RENDERER MODULE
========================= */

function render(state) {
  document.querySelectorAll(".node").forEach(el => {
    el.classList.remove("visited", "current");
  });

  state.visited.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.add("visited");
  });

  const currentEl = document.getElementById(state.currentNode);
  if (currentEl) currentEl.classList.add("current");
}


/* =========================
   RAIL MODULE
========================= */

function updateRail(state) {
  document.getElementById("moveCount").textContent = state.moves;
  document.getElementById("trapCount").textContent = state.trapsHit;
  document.getElementById("score").textContent = calculateScore(state);

  if (state.complete) {
    document.getElementById("completionMessage").textContent =
      "Resume optimized. ATS pathway successful.";
  }
}


/* =========================
   MAIN WIRING
========================= */

render(state);
updateRail(state);

document.querySelectorAll(".node").forEach(node => {
  node.addEventListener("click", () => {
    const result = attemptMove(state, node.id);

    if (result.success) {
      render(state);
      updateRail(state);
    }
  });
});

</script>

</body>
</html>
